(function(a){a.widget("nmk.loongshadow",{options:{rotation:45,lenght:200,baseOpacity:0.3,darken:50,fadeIn:false,fadeTime:300},shadow:null,_create:function(d){var c=a(this);this.options=a.extend(this.options,d);var b=a("<div />");b.addClass("loongshadow");this.shadow=b;b.css({display:this.options.fadeIn?"none":"block",position:"absolute",zIndex:-1});this.refresh();a(document.body).append(b);if(this.options.fadeIn){b.fadeIn(this.options.fadeTime)}},option:function(b,c){if(c===undefined){return this.options[b]}else{this.options[b]=c;this.refresh()}},refresh:function(){var e=this.shadow;var g=this.element.offset().top;var c=this.element.offset().left;var f=Math.sqrt(Math.pow(this.element.outerHeight(),2)+Math.pow(this.element.outerWidth(),2));var d=f/this.element.outerHeight();if(this.options.rotation>0&&this.options.rotation<=90){var j=90-(180*(Math.acos(this.element.outerWidth()/f)))/Math.PI}else{if(this.options.rotation>90&&this.options.rotation<=180){var j=-90+(180*(Math.acos(this.element.outerWidth()/f)))/Math.PI}else{if(this.options.rotation>180&&this.options.rotation<=270){var j=90-(180*(Math.acos(this.element.outerWidth()/f)))/Math.PI}else{if(this.options.rotation>270&&this.options.rotation<=360){var j=-90+(180*(Math.acos(this.element.outerWidth()/f)))/Math.PI}}}}skewAngle=(this.options.rotation-j);if(skewAngle<0.000001&&skewAngle>0.00001){skewAngle=0}var i=this._darkenColor(this.element.css("background-color"),this.options.darken);e.css({height:this.element.outerHeight()+"px",width:(this.options.lenght)+"px",top:g+"px",left:c+"px"});if((this.options.rotation>=0&&this.options.rotation<=90)||(this.options.rotation>270&&this.options.rotation<=360)){e.css("background","-webkit-gradient(linear, left top, right top, color-stop(0%,rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+")), color-stop(100%,rgba("+i.r+", "+i.g+", "+i.b+",0)))");e.css("background","-webkit-linear-gradient(left, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-moz-linear-gradient(left, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%, rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-o-linear-gradient(left, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-ms-linear-gradient(left, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","linear-gradient(to right, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)")}else{if((this.options.rotation>90&&this.options.rotation<=180)||(this.options.rotation>180&&this.options.rotation<=270)){e.css("background","-webkit-gradient(linear, right top, left top, color-stop(0%,rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+")), color-stop(100%,rgba("+i.r+", "+i.g+", "+i.b+",0)))");e.css("background","-webkit-linear-gradient(right, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-moz-linear-gradient(right, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%, rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-o-linear-gradient(right, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","-ms-linear-gradient(right, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)");e.css("background","linear-gradient(to left, rgba("+i.r+", "+i.g+", "+i.b+","+this.options.baseOpacity+") 0%,rgba("+i.r+", "+i.g+", "+i.b+",0) 100%)")}}var b="rotate("+j+"deg) skewY("+skewAngle+"deg) scaleY("+d+")";if(this.options.rotation>90&&this.options.rotation<=270){b="translateX("+(this.element.outerWidth()-this.options.lenght)+"px) "+b}e.css("transform",b);e.css("-webkit-transform",b);e.css("-moz-transform",b);e.css("-o-transform",b);e.css("-ms-transform",b);if(this.options.rotation>=0&&this.options.rotation<=90){var h="0 100%"}else{if(this.options.rotation>90&&this.options.rotation<=180){var h="100% 100%"}else{if(this.options.rotation>180&&this.options.rotation<=270){var h="100% 0"}else{if(this.options.rotation>270&&this.options.rotation<=360){var h="0 0"}}}}e.css("transform-origin",h);e.css("-webkit-transform-origin",h);e.css("-moz-transform-origin",h);e.css("-o-transform-origin",h);e.css("-ms-transform-origin",h)},destroy:function(){a(".loongshadow").remove();a.Widget.prototype.destroy.call(this)},_darkenColor:function(e,d){if(!d){d=1}var c=e.match(/[0-9\.]+/g);var b={r:Math.round(c[0]-(c[0]*d/100)),g:Math.round(c[1]-(c[1]*d/100)),b:Math.round(c[2]-(c[2]*d/100))};return b}})}(jQuery));